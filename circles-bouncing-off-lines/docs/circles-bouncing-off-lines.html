<!DOCTYPE html>

<html>
<head>
  <title>circles-bouncing-off-lines.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>circles-bouncing-off-lines.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>;(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(exports)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h2 id="the-top-level-functions-that-run-the-simulation">The top-level functions that run the simulation</h2>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p><strong>start()</strong> creates the lines and circles and starts the simulation.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">start</span><span class="hljs-params">()</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>In index.html, there is a canvas tag that the game will be drawn in.
Grab that canvas out of the DOM.  From it, get the drawing
context, an object that contains functions that allow drawing to the canvas.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> screen = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'circles-bouncing-off-lines'</span>).getContext(<span class="hljs-string">'2d'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p><code>world</code> holds the current state of the world.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> world = {
      circles: [],</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Set up the five lines.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      lines: [
        makeLine({ x: <span class="hljs-number">100</span>, y: <span class="hljs-number">100</span> }),
        makeLine({ x: <span class="hljs-number">200</span>, y: <span class="hljs-number">100</span> }),
        makeLine({ x: <span class="hljs-number">150</span>, y: <span class="hljs-number">150</span> }),
        makeLine({ x: <span class="hljs-number">100</span>, y: <span class="hljs-number">200</span> }),
        makeLine({ x: <span class="hljs-number">220</span>, y: <span class="hljs-number">200</span> }),
      ],

      dimensions: { x: screen.canvas.width, y: screen.canvas.height },</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p><code>timeLastCircleMade</code> is used in the periodic creation of new circles.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      timeLastCircleMade: <span class="hljs-number">0</span>
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p><strong>tick()</strong> is the main simulation tick function.  It loops forever, running 60ish times a second.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">tick</span><span class="hljs-params">()</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Update state of circles and lines.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      update(world);</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Draw circles and lines.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      draw(world, screen);</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Queue up the next call to tick with the browser.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      requestAnimationFrame(tick);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Run the first game tick.  All future calls will be scheduled by
<code>tick()</code> itself.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    tick();
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Export <code>start()</code> so it can be run by index.html</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  exports.start = start;</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p><strong>update()</strong> updates the state of the lines and circles.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">update</span><span class="hljs-params">(world)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Move and bounce the circles.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    updateCircles(world)</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Create new circle if one hasn’t been created for a while.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    createNewCircleIfDue(world);</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Rotate the lines.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    updateLines(world);
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p><strong>updateCircles()</strong> moves and bounces the circles.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">updateCircles</span><span class="hljs-params">(world)</span> </span>{
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = world.circles.length - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i--) {
      <span class="hljs-keyword">var</span> circle = world.circles[i];</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Run through all lines.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> j = <span class="hljs-number">0</span>; j &lt; world.lines.length; j++) {
        <span class="hljs-keyword">var</span> line = world.lines[j];</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>If <code>line</code> is intersecting <code>circle</code>, bounce circle off line.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (trig.isLineIntersectingCircle(circle, line)) {
          physics.bounceCircle(circle, line);
        }
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Apply gravity to the velocity of <code>circle</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      physics.applyGravity(circle);</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>Move <code>circle</code> according to its velocity.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      physics.moveCircle(circle);</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>Remove circles that are off screen.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (!isCircleInWorld(circle, world.dimensions)) {
        world.circles.splice(i, <span class="hljs-number">1</span>);
      }
    }
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p><strong>createNewCircleIfDue()</strong> creates a new circle every so often.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createNewCircleIfDue</span><span class="hljs-params">(world)</span> </span>{
    <span class="hljs-keyword">var</span> now = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().getTime();
    <span class="hljs-keyword">if</span> (now - world.timeLastCircleMade &gt; <span class="hljs-number">400</span>) {
      world.circles.push(makeCircle({ x: world.dimensions.x / <span class="hljs-number">2</span>, y: -<span class="hljs-number">5</span> }));</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>Update last circle creation time.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      world.timeLastCircleMade = now;
    }
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p><strong>updateLines()</strong> rotates the lines.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">updateLines</span><span class="hljs-params">(world)</span> </span>{
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; world.lines.length; i++) {
      world.lines[i].angle += world.lines[i].rotateSpeed;
    }
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p><strong>draw()</strong> draws the all the circles and lines in the simulation.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">draw</span><span class="hljs-params">(world, screen)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>Clear away the drawing from the previous tick.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    screen.clearRect(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, world.dimensions.x, world.dimensions.y);

    <span class="hljs-keyword">var</span> bodies = world.circles.concat(world.lines);
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; bodies.length; i++) {
      bodies[i].draw(screen);
    }
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p><strong>makeCircle()</strong> creates a circle that has the passed <code>center</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">makeCircle</span><span class="hljs-params">(center)</span> </span>{
    <span class="hljs-keyword">return</span> {
      center: center,
      velocity: { x: <span class="hljs-number">0</span>, y: <span class="hljs-number">0</span> },
      radius: <span class="hljs-number">5</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>The circle has its own built-in <code>draw()</code> function.  This allows
the main <code>draw()</code> to just polymorphicly call <code>draw()</code> on circles and lines.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      draw: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(screen)</span> </span>{
        screen.beginPath();
        screen.arc(<span class="hljs-keyword">this</span>.center.x, <span class="hljs-keyword">this</span>.center.y, <span class="hljs-keyword">this</span>.radius, <span class="hljs-number">0</span>, <span class="hljs-built_in">Math</span>.PI * <span class="hljs-number">2</span>, <span class="hljs-literal">true</span>);
        screen.closePath();
        screen.fillStyle = <span class="hljs-string">"black"</span>;
        screen.fill();
      }
    };
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p><strong>makeLine()</strong> creates a line that has the passed <code>center</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">makeLine</span><span class="hljs-params">(center)</span> </span>{
    <span class="hljs-keyword">return</span> {
      center: center,
      len: <span class="hljs-number">70</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>Angle of the line in degrees.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      angle: <span class="hljs-number">0</span>,

      rotateSpeed: <span class="hljs-number">0.5</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>The line has its own built-in <code>draw()</code> function.  This allows
the main <code>draw()</code> to just polymorphicly call <code>draw()</code> on circles and lines.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      draw: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(screen)</span> </span>{
        <span class="hljs-keyword">var</span> end1 = trig.lineEndPoints(<span class="hljs-keyword">this</span>)[<span class="hljs-number">0</span>];
        <span class="hljs-keyword">var</span> end2 = trig.lineEndPoints(<span class="hljs-keyword">this</span>)[<span class="hljs-number">1</span>];

        screen.beginPath();
        screen.lineWidth = <span class="hljs-number">1.5</span>;
        screen.moveTo(end1.x, end1.y);
        screen.lineTo(end2.x, end2.y);
        screen.closePath();

        screen.strokeStyle = <span class="hljs-string">"black"</span>;
        screen.stroke();
      }
    };
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p><strong>isCircleInWorld()</strong> returns true if <code>circle</code> is on screen.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isCircleInWorld</span><span class="hljs-params">(circle, worldDimensions)</span> </span>{
    <span class="hljs-keyword">return</span> circle.center.x &gt; -circle.radius &amp;&amp;
      circle.center.x &lt; worldDimensions.x + circle.radius &amp;&amp;
      circle.center.y &gt; -circle.radius &amp;&amp;
      circle.center.y &lt; worldDimensions.y + circle.radius;
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <h2 id="trigonometry-functions-to-help-with-calculating-circle-movement">Trigonometry functions to help with calculating circle movement</h2>

            </div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
  <span class="hljs-keyword">var</span> trig = {</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p><strong>distance()</strong> returns the distance between <code>point1</code> and <code>point2</code>
as the crow flies.  Uses Pythagoras’s theorem.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    distance: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(point1, point2)</span> </span>{
      <span class="hljs-keyword">var</span> x = point1.x - point2.x;
      <span class="hljs-keyword">var</span> y = point1.y - point2.y;
      <span class="hljs-keyword">return</span> <span class="hljs-built_in">Math</span>.sqrt(x * x + y * y);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p><strong>magnitude()</strong> returns the magnitude of the passed vector.
Sort of like the vector’s speed.  A vector with a larger x or y
will have a larger magnitude.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    magnitude: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(vector)</span> </span>{
      <span class="hljs-keyword">return</span> <span class="hljs-built_in">Math</span>.sqrt(vector.x * vector.x + vector.y * vector.y);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p><strong>unitVector()</strong> returns the unit vector for <code>vector</code>.
A unit vector points in the same direction as the original,
but has a magnitude of 1.  It’s like a direction with a
speed that is the same as all other unit vectors.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    unitVector: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(vector)</span> </span>{
      <span class="hljs-keyword">return</span> {
        x: vector.x / trig.magnitude(vector),
        y: vector.y / trig.magnitude(vector)
      };
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p><strong>dotProduct()</strong> returns the dot product of <code>vector1</code> and
<code>vector2</code>. A dot product represents the amount one vector goes
in the direction of the other.  Imagine <code>vector2</code> runs along
the ground and <code>vector1</code> represents a ball fired from a
cannon. If <code>vector2</code> is multiplied by the dot product of the
two vectors, it produces a vector that represents the amount
of ground covered by the ball.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    dotProduct: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(vector1, vector2)</span> </span>{
      <span class="hljs-keyword">return</span> vector1.x * vector2.x + vector1.y * vector2.y;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p><strong>vectorBetween()</strong> returns the vector that runs between <code>startPoint</code>
and <code>endPoint</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    vectorBetween: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(startPoint, endPoint)</span> </span>{
      <span class="hljs-keyword">return</span> {
        x: endPoint.x - startPoint.x,
        y: endPoint.y - startPoint.y
      };
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p><strong>lineEndPoints()</strong> returns an array containing the points
at each end of <code>line</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    lineEndPoints: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(line)</span> </span>{
      <span class="hljs-keyword">var</span> angleRadians = line.angle * <span class="hljs-number">0.01745</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>Create a unit vector that represents the heading of
<code>line</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> lineUnitVector = trig.unitVector({
        x: <span class="hljs-built_in">Math</span>.cos(angleRadians),
        y: <span class="hljs-built_in">Math</span>.sin(angleRadians)
      });</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>Multiply the unit vector by half the line length.  This
produces a vector that represents the offset of one of the
ends of the line from the center.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> endOffsetFromCenterVector = {
        x: lineUnitVector.x * line.len / <span class="hljs-number">2</span>,
        y: lineUnitVector.y * line.len / <span class="hljs-number">2</span>
      };</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>Return an array that contains the points at the two <code>line</code> ends.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">return</span> [</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>Add the end offset to the center to get one end of ‘line’.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        {
          x: line.center.x + endOffsetFromCenterVector.x,
          y: line.center.y + endOffsetFromCenterVector.y
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>Subtract the end offset from the center to get the other
end of <code>line</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        {
          x: line.center.x - endOffsetFromCenterVector.x,
          y: line.center.y - endOffsetFromCenterVector.y
        }
      ];
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p><strong>pointOnLineClosestToCircle()</strong> returns the point on <code>line</code>
closest to <code>circle</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    pointOnLineClosestToCircle: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(circle, line)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>Get the points at each end of <code>line</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> lineEndPoint1 = trig.lineEndPoints(line)[<span class="hljs-number">0</span>];
      <span class="hljs-keyword">var</span> lineEndPoint2 = trig.lineEndPoints(line)[<span class="hljs-number">1</span>];</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>Create a vector that represents the line</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> lineUnitVector = trig.unitVector(
        trig.vectorBetween(lineEndPoint1, lineEndPoint2));</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>Pick a line end and create a vector that represents the
imaginary line between the end and the circle.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> lineEndToCircleVector = trig.vectorBetween(lineEndPoint1, circle.center);</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>Get a dot product of the vector between the line end and circle, and
the line vector.  (See the <code>dotProduct()</code> function for a
fuller explanation.)  This projects the line end and circle
vector along the line vector.  Thus, it represents how far
along the line to go from the end to get to the point on the
line that is closest to the circle.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> projection = trig.dotProduct(lineEndToCircleVector, lineUnitVector);</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>If <code>projection</code> is less than or equal to 0, the closest point
is at or past <code>lineEndPoint1</code>.  So, return <code>lineEndPoint1</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (projection &lt;= <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">return</span> lineEndPoint1;</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>If <code>projection</code> is greater than or equal to the length of the
line, the closest point is at or past <code>lineEndPoint2</code>.  So,
return <code>lineEndPoint2</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (projection &gt;= line.len) {
        <span class="hljs-keyword">return</span> lineEndPoint2;</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>The projection indicates a point part way along the line.
Return that point.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> {
          x: lineEndPoint1.x + lineUnitVector.x * projection,
          y: lineEndPoint1.y + lineUnitVector.y * projection
        };
      }
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p><strong>isLineIntersectingCircle()</strong> returns true if <code>line</code> is
intersecting <code>circle</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    isLineIntersectingCircle: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(circle, line)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p>Get point on line closest to circle.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> closest = trig.pointOnLineClosestToCircle(circle, line);</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <p>Get the distance between the closest point and the center of
the circle.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> circleToLineDistance = trig.distance(circle.center, closest);</pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p>Return true if distance is less than the radius.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">return</span> circleToLineDistance &lt; circle.radius;
    }
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <h2 id="physics-functions-for-calculating-circle-movement">Physics functions for calculating circle movement</h2>

            </div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
  <span class="hljs-keyword">var</span> physics = {</pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <p><strong>applyGravity()</strong> adds gravity to the velocity of <code>circle</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    applyGravity: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(circle)</span> </span>{
      circle.velocity.y += <span class="hljs-number">0.06</span>;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <p><strong>moveCircle()</strong> adds the velocity of the circle to its center.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    moveCircle: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(circle)</span> </span>{
      circle.center.x += circle.velocity.x;
      circle.center.y += circle.velocity.y;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <p><strong>bounceCircle()</strong> assumes <code>line</code> is intersecting <code>circle</code> and
bounces <code>circle</code> off <code>line</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    bounceCircle: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(circle, line)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <p>Get the vector that points out from the surface the circle is
bouncing on.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> bounceLineNormal = physics.bounceLineNormal(circle, line);</pre></div></div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              <p>Set the new circle velocity by reflecting the old velocity in
<code>bounceLineNormal</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> dot = trig.dotProduct(circle.velocity, bounceLineNormal);
      circle.velocity.x -= <span class="hljs-number">2</span> * dot * bounceLineNormal.x;
      circle.velocity.y -= <span class="hljs-number">2</span> * dot * bounceLineNormal.y;</pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              <p>Move the circle until it has cleared the line.  This stops
the circle getting stuck in the line.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">while</span> (trig.isLineIntersectingCircle(circle, line)) {
        physics.moveCircle(circle);
      }
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-69">&#182;</a>
              </div>
              <p><strong>bounceLineNormal()</strong> assumes <code>line</code> intersects <code>circle</code>.  It
returns the normal to the side of the line that the <code>circle</code> is
hitting.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    bounceLineNormal: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(circle, line)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-70">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-70">&#182;</a>
              </div>
              <p>Get vector that starts at the closest point on
the line and ends at the circle.  If the circle is hitting
the flat of the line, this vector will point perpenticular to
the line.  If the circle is hitting the end of the line, the
vector will point from the end to the center of the circle.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> circleToClosestPointOnLineVector =
          trig.vectorBetween(
            trig.pointOnLineClosestToCircle(circle, line),
            circle.center);</pre></div></div>
            
        </li>
        
        
        <li id="section-71">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-71">&#182;</a>
              </div>
              <p>Make the normal a unit vector and return it.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">return</span> trig.unitVector(circleToClosestPointOnLineVector);
    }
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-72">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-72">&#182;</a>
              </div>
              <h2 id="start">Start</h2>

            </div>
            
        </li>
        
        
        <li id="section-73">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-73">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-74">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-74">&#182;</a>
              </div>
              <p>When the DOM is ready, start the simulation.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-built_in">window</span>.addEventListener(<span class="hljs-string">'load'</span>, start);
})(<span class="hljs-keyword">this</span>);</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
